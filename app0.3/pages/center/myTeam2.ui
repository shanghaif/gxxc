<template>
  <ui-page style="overflow-y: hidden;">
      <ui-view class=box_col style="{{ { height: pageHeight(0)+ 'px'} }}">
          <ui-view class="tabSty">
            <ui-row height=40>
              <ui-col>
                <ui-segment bindchange="segmentChange">
                    <ui-segment-item>
                        全部
                    </ui-segment-item>
                    <ui-segment-item>
                        一级用户
                    </ui-segment-item>
                    <ui-segment-item>
                        二级用户
                    </ui-segment-item>
                </ui-segment>
              </ui-col>
            </ui-row>
          </ui-view>
          <ui-view class="box_col_auto" style="position:relative">
            <ui-view class="listErr" bindtap="getNewpage" ui:if="{{items.length==0}}">
              <ui-icon mode="wechat" type="warn"
                color="#9e9e9e" size="50"></ui-icon>
              <ui-view class="mess">
                数据没有了,点击重新获取。
              </ui-view>
            </ui-view>
            <ui-scroll-view
                scroll-y
                height="{{pageHeight(-70)}}"
                pull-down="{{ pullDown }}"
                enable-reach-bottom-load ="{{loadMore}}"
                on-load-more="{{ handleLoadMore }}">
                  <ui-view class="content_list">
                    <ui-view ui:for="{{ items }}">
                      <ui-view style="background:#ffffff">
                          <ui-row height="100" space-bottom="10">
                            <ui-col span="3" align="center" vertical-align="middle">
                                <ui-image src="{{item.userDetail.yhTx | yhTx}}" 
                                width="70" height="70"></ui-image>
                            </ui-col>
                            <ui-col span="9">
                                <ui-row space-top='10' height="50">
                                    <ui-col span="6">
                                      {{item.yhXm | yhXm}}
                                    </ui-col>
                                    <ui-col span="5" align="right">
                                      <a :href="'tel:'+item.yhSjhm">{{item.yhSjhm}}</a>
                                    </ui-col>
                                </ui-row>
                                <ui-row height="50">
                                    <ui-col span="4">
                                        <ui-view style="{{{color:item.userDetail.ddSfjx=='1'?'#00b65f':'#ff8800'}}}">
                                          {{item.userDetail.ddSfjx | ddSfjx}}
                                        </ui-view>
                                    </ui-col>
                                    <ui-col span="4" align="left">
                                        <ui-view style="{{{color:item.userDetail.yhLx=='3'?'#ff000a':'#2d8cf0'}}}">
                                              <ui-text v-show="item.userDetail.ddSfjx=='1'">
                                                {{item.userDetail.yhLx | yhLx}}
                                              </ui-text>
                                        </ui-view>
                                    </ui-col>
                                    <ui-col span="3" align="right">
                                          {{item.userGrade | userGrade}}
                                    </ui-col>
                                </ui-row>
                            </ui-col>
                          </ui-row>
                      </ui-view>
                    </ui-view>
                  </ui-view>
                  <ui-view style="width:200px;margin:0 auto;">
                    <ui-divider ui:show="{{!loadMore}}">没有新数据了</ui-divider>
                  </ui-view>
            </ui-scroll-view>
          </ui-view>
      </ui-view>

  </ui-page>
</template>

<script>
  import mixin from '#/static/ajax/mixin'
  export default {
    config: {
      navigationBarBackgroundColor:"#26a2ff",
      navigationBarTextStyle:"white",
      navigationBarTitleText:"我的团队",
      title:'我的团队',
      backgroundColor:'#f2f2f2',
      delay:false,//延迟加载
    },
    mixins:[mixin],
    data () {
      return {
        items: [],
        pullDown: {
          distance: 50,
          onBegin: () => {},
          onActive: this.handleActive,
          onAfter: this.handlePullDownAfter
        },
        count:0,
        loadMore:true,
        pageNum:1,//当前页面
        pages:0,//页面总数
        listTyp:0,//当前数据展示的状态
      }
    },
    created () {
      this.getpagerliost(1,0)
    },
    methods: {
      segmentChange(index){
        this.items = []
        this.listTyp = index
        this.getpagerliost(this.pageNum,this.listTyp)
      },
      getNewpage(){
        this.getpagerliost(this.pageNum,this.listTyp)
      },
      getpagerliost(num,code){
        var v = this
        this.$http('post',ui.getApp().apis.TEAM,{pageSize:10,pageNum:num,userGrade:code},(res)=>{
          console.log('----------',res);
          if(res.code==200){
            v.pages = res.page.pages
            v.pageNum = res.page.pageNum
            if(res.page.list){
              res.page.list.forEach((item,index) => {
                  v.items.push(item)
              });
            }
          }
          
        })
      },
      handleLoadMore () {//到底加载
        console.log(this.pageNum);
        console.log(this.pages);
        if(this.pageNum<this.pages){
          this.getpagerliost(this.pageNum,this.listTyp)
        }else{
          this.loadMore = false
          return false
        }
      },
      handleActive () {//下拉刷新时的方法
          // this.pageNum =1
          // this.items = []
          // this.getpagerliost(this.pageNum)
          // if(this.pageNum<this.pages){
          //   this.loadMore = true
          // }
      },
      // 下拉结束后，执行的函数。因为只要下拉即时没有到达刷新的高度也会触发这个方法
      // flag 为1表示执行了handleActive。为undefined代表handleActive没有执行。
      handlePullDownAfter (flag) {
          this.pageNum =1
          this.items = []
          this.getpagerliost(this.pageNum,this.listTyp)
          if(this.pageNum<this.pages){
            this.loadMore = true
          }
          ui.showToast({
            title: '数据更新'
          })
      }
    },
    mounted () {
    } 
  }

</script>

<style lang="less">
  .tabSty{
    background: #fff;
    padding: 15rpx 0;
    border-bottom: #f2f2f2 5rpx solid;
  }
  .listErr{
    width: 100%;
    text-align: center;
    position: absolute;
    top: 35%;
    left: 50%;
    transform: translate(-50%,-50%);
    z-index: 100;
    .mess{
      font-size: 40rpx;
    }
  }
</style>